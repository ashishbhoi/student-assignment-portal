@page
@using Microsoft.AspNetCore.Http.Features
@model TwoFactorAuthenticationModel
@{
    ViewData["Title"] = "Two-factor authentication (2FA)";
    ViewData["ActivePage"] = ManageNavPages.TwoFactorAuthentication;
}

<div class="max-w-lg mx-auto bg-surface rounded-lg shadow-md p-8">
    <h3 class="text-2xl font-bold text-on-surface mb-6">@ViewData["Title"]</h3>
    <partial name="_StatusMessage" for="StatusMessage"/>

    @{
        var consentFeature = HttpContext.Features.Get<ITrackingConsentFeature>();
        if (consentFeature?.CanTrack ?? true)
        {
            if (Model.Is2faEnabled)
            {
                if (Model.RecoveryCodesLeft == 0)
                {
                    <div class="bg-error-container text-on-error-container p-4 rounded-md mb-4">
                        <strong class="font-bold">You have no recovery codes left.</strong>
                        <p>You must <a asp-page="./GenerateRecoveryCodes" class="underline hover:text-error">generate a
                                new set of recovery codes</a> before you can log in with a recovery code.</p>
                    </div>
                }
                else if (Model.RecoveryCodesLeft == 1)
                {
                    <div class="bg-error-container text-on-error-container p-4 rounded-md mb-4">
                        <strong class="font-bold">You have 1 recovery code left.</strong>
                        <p>You can <a asp-page="./GenerateRecoveryCodes" class="underline hover:text-error">generate a
                                new set of recovery codes</a>.</p>
                    </div>
                }
                else if (Model.RecoveryCodesLeft <= 3)
                {
                    <div class="bg-yellow-100 text-yellow-800 p-4 rounded-md mb-4">
                        <strong class="font-bold">You have @Model.RecoveryCodesLeft recovery codes left.</strong>
                        <p>You should <a asp-page="./GenerateRecoveryCodes" class="underline hover:text-yellow-900">generate
                                a new set of recovery codes</a>.</p>
                    </div>
                }

                if (Model.IsMachineRemembered)
                {
                    <form method="post" class="inline-block">
                        <button type="submit"
                                class="bg-secondary text-on-secondary font-bold py-2 px-4 rounded-md hover:bg-secondary-dark">
                            Forget this browser
                        </button>
                    </form>
                }

                <a asp-page="./Disable2fa"
                   class="bg-secondary text-on-secondary font-bold py-2 px-4 rounded-md hover:bg-secondary-dark">Disable
                    2FA</a>
                <a asp-page="./GenerateRecoveryCodes"
                   class="bg-secondary text-on-secondary font-bold py-2 px-4 rounded-md hover:bg-secondary-dark">Reset
                    recovery codes</a>
            }

            <h4 class="text-lg font-semibold text-on-surface mt-8 mb-4">Authenticator app</h4>
            <div class="space-x-2">
                @if (!Model.HasAuthenticator)
                {
                    <a id="enable-authenticator" asp-page="./EnableAuthenticator"
                       class="bg-primary text-on-primary font-bold py-2 px-4 rounded-md hover:bg-primary-dark">Add
                        authenticator app</a>
                }
                else
                {
                    <a id="enable-authenticator" asp-page="./EnableAuthenticator"
                       class="bg-primary text-on-primary font-bold py-2 px-4 rounded-md hover:bg-primary-dark">Set up
                        authenticator app</a>
                    <a id="reset-authenticator" asp-page="./ResetAuthenticator"
                       class="bg-secondary text-on-secondary font-bold py-2 px-4 rounded-md hover:bg-secondary-dark">Reset
                        authenticator app</a>
                }
            </div>
        }
        else
        {
            <div class="bg-error-container text-on-error-container p-4 rounded-md">
                <strong class="font-bold">Privacy and cookie policy have not been accepted.</strong>
                <p>You must accept the policy before you can enable two factor authentication.</p>
            </div>
        }
    }
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial"/>
}
